<Window x:Class="RaceOverlay.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:RaceOverlay.App"
        xmlns:views="clr-namespace:RaceOverlay.Engine.Views;assembly=RaceOverlay.Engine"
        mc:Ignorable="d"
        Title="RaceOverlay - Widget Manager"
        Height="600"
        Width="1000"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource RO.BackgroundBrush}">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <local:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>
        <Style x:Key="SettingsCheckBox" TargetType="CheckBox">
            <Setter Property="Foreground" Value="{StaticResource RO.ForegroundBrush}"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Margin" Value="0,4"/>
        </Style>
        <Style x:Key="SettingsLabel" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource RO.MutedBrush}"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Margin" Value="0,4,8,4"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        <Style x:Key="SettingsTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="{StaticResource RO.SurfaceBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource RO.ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource RO.BorderBrush}"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="Width" Value="60"/>
            <Setter Property="Margin" Value="0,4"/>
        </Style>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Status Bar -->
        <Border Grid.Row="0" Grid.ColumnSpan="3" Background="{StaticResource RO.SurfaceBrush}" BorderBrush="{StaticResource RO.BorderBrush}" BorderThickness="0,0,0,1" Padding="12,8">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock Text="Drag Mode: " Foreground="{StaticResource RO.MutedBrush}" FontSize="11"/>
                <Ellipse Width="8" Height="8" Fill="{StaticResource RO.GreenBrush}" Margin="4,0,0,0" VerticalAlignment="Center" Name="DragModeIndicator"/>
                <TextBlock Text="OFF" Foreground="{StaticResource RO.MutedBrush}" FontSize="11" Margin="4,0,0,0" Name="DragModeText"/>
                <Separator Width="1" Background="{StaticResource RO.BorderBrush}" Margin="12,0"/>
                <TextBlock Text="Press CTRL+F12 to toggle drag mode" Foreground="{StaticResource RO.MutedBrush}" FontSize="10" FontStyle="Italic"/>
            </StackPanel>
        </Border>

        <!-- Left Panel -->
        <Border Grid.Row="1" Grid.Column="0" Background="{StaticResource RO.SurfaceBrush}" BorderBrush="{StaticResource RO.BorderBrush}" BorderThickness="0,0,1,0">
            <DockPanel LastChildFill="True">
                <Border DockPanel.Dock="Top" Background="{StaticResource RO.BackgroundBrush}">
                    <TextBlock Text="Available Widgets" FontSize="14" FontWeight="Bold" Foreground="{StaticResource RO.ForegroundBrush}" Margin="12"/>
                </Border>
                <ListBox Name="WidgetListBox" ItemsSource="{Binding AvailableWidgets}" SelectedItem="{Binding SelectedWidget}" Background="Transparent" BorderThickness="0"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        </Style>
                    </ListBox.ItemContainerStyle>
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Margin="10">
                                <TextBlock Text="{Binding DisplayName}" FontWeight="Bold" Foreground="{StaticResource RO.ForegroundBrush}"/>
                                <TextBlock Text="{Binding Description}" FontSize="11" Foreground="{StaticResource RO.MutedBrush}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" MaxHeight="30" Margin="0,4,0,0"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </DockPanel>
        </Border>

        <!-- Splitter -->
        <GridSplitter Grid.Row="1" Grid.Column="1" Width="5" HorizontalAlignment="Center" VerticalAlignment="Stretch" Background="{StaticResource RO.BorderBrush}" ShowsPreview="True"/>

        <!-- Right Panel -->
        <DockPanel Grid.Row="1" Grid.Column="2" LastChildFill="True">
            <Border DockPanel.Dock="Top" Background="{StaticResource RO.BackgroundBrush}">
                <TextBlock Text="Configuration" FontSize="14" FontWeight="Bold" Foreground="{StaticResource RO.ForegroundBrush}" Margin="12"/>
            </Border>

            <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" HorizontalAlignment="Right" Margin="12" Height="40">
                <Button Command="{Binding AddWidgetCommand}" Content="Add Widget" Margin="4" Background="{StaticResource RO.PurpleBrush}" Foreground="White" FontSize="12" Cursor="Hand" Padding="12,8"/>
                <Button Command="{Binding RemoveWidgetCommand}" Content="Remove Widget" Margin="4" Background="{StaticResource RO.MagentaBrush}" Foreground="White" FontSize="12" Cursor="Hand" Padding="12,8"/>
            </StackPanel>

            <!-- No widget selected message -->
            <Border DockPanel.Dock="Top" Background="Transparent" Margin="16" Visibility="{Binding IsWidgetSelected, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                <TextBlock Text="No widget selected" Foreground="{StaticResource RO.MutedBrush}" FontStyle="Italic"/>
            </Border>

            <!-- Settings panel (visible when widget selected) -->
            <Border Background="Transparent" Margin="16"
                    Visibility="{Binding IsWidgetSelected, Converter={StaticResource BooleanToVisibilityConverter}}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- Widget Description -->
                        <TextBlock Text="{Binding SelectedWidget.Description}" FontSize="12" Foreground="{StaticResource RO.MutedBrush}" TextWrapping="Wrap" Margin="0,0,0,16"/>

                        <!-- Relative Overlay Settings -->
                        <StackPanel>
                            <StackPanel.Style>
                                <Style TargetType="StackPanel">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedWidgetId}" Value="relative-overlay">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </StackPanel.Style>

                            <!-- Columns Section -->
                            <TextBlock Text="COLUMNS" FontSize="11" FontWeight="Bold" Foreground="{StaticResource RO.MutedBrush}" Margin="0,0,0,8"/>
                            <CheckBox Content="Position" IsChecked="{Binding ShowPosition}" Style="{StaticResource SettingsCheckBox}"/>
                            <CheckBox Content="Class Color" IsChecked="{Binding ShowClassColor}" Style="{StaticResource SettingsCheckBox}"/>
                            <CheckBox Content="Driver Name" IsChecked="{Binding ShowDriverName}" Style="{StaticResource SettingsCheckBox}"/>
                            <CheckBox Content="Rating" IsChecked="{Binding ShowRating}" Style="{StaticResource SettingsCheckBox}"/>
                            <CheckBox Content="Stint" IsChecked="{Binding ShowStint}" Style="{StaticResource SettingsCheckBox}"/>
                            <CheckBox Content="Lap Time" IsChecked="{Binding ShowLapTime}" Style="{StaticResource SettingsCheckBox}"/>
                            <CheckBox Content="Gap" IsChecked="{Binding ShowGap}" Style="{StaticResource SettingsCheckBox}"/>

                            <!-- Data Section -->
                            <TextBlock Text="DATA" FontSize="11" FontWeight="Bold" Foreground="{StaticResource RO.MutedBrush}" Margin="0,16,0,8"/>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Drivers Ahead" Style="{StaticResource SettingsLabel}"/>
                                <TextBox Text="{Binding DriversAhead, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource SettingsTextBox}"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Drivers Behind" Style="{StaticResource SettingsLabel}"/>
                                <TextBox Text="{Binding DriversBehind, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource SettingsTextBox}"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Update Interval (ms)" Style="{StaticResource SettingsLabel}"/>
                                <TextBox Text="{Binding UpdateIntervalMs, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource SettingsTextBox}"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Fuel Calculator Settings -->
                        <StackPanel>
                            <StackPanel.Style>
                                <Style TargetType="StackPanel">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedWidgetId}" Value="fuel-calculator">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </StackPanel.Style>

                            <TextBlock Text="FUEL SETTINGS" FontSize="11" FontWeight="Bold" Foreground="{StaticResource RO.MutedBrush}" Margin="0,0,0,8"/>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Tank Capacity (L)" Style="{StaticResource SettingsLabel}"/>
                                <TextBox Text="{Binding FuelTankCapacity, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource SettingsTextBox}"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Inputs Settings -->
                        <StackPanel>
                            <StackPanel.Style>
                                <Style TargetType="StackPanel">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedWidgetId}" Value="inputs">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </StackPanel.Style>

                            <TextBlock Text="INPUTS SETTINGS" FontSize="11" FontWeight="Bold" Foreground="{StaticResource RO.MutedBrush}" Margin="0,0,0,8"/>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Update Interval (ms)" Style="{StaticResource SettingsLabel}"/>
                                <TextBox Text="{Binding InputsUpdateIntervalMs, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource SettingsTextBox}"/>
                            </StackPanel>

                            <TextBlock Text="COLORS" FontSize="11" FontWeight="Bold" Foreground="{StaticResource RO.MutedBrush}" Margin="0,16,0,8"/>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Throttle" Style="{StaticResource SettingsLabel}"/>
                                <TextBox Text="{Binding InputsThrottleColor, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource SettingsTextBox}" Width="80"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Brake" Style="{StaticResource SettingsLabel}"/>
                                <TextBox Text="{Binding InputsBrakeColor, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource SettingsTextBox}" Width="80"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Clutch" Style="{StaticResource SettingsLabel}"/>
                                <TextBox Text="{Binding InputsClutchColor, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource SettingsTextBox}" Width="80"/>
                            </StackPanel>

                            <TextBlock Text="VISIBILITY" FontSize="11" FontWeight="Bold" Foreground="{StaticResource RO.MutedBrush}" Margin="0,16,0,8"/>

                            <CheckBox Content="Show Clutch" IsChecked="{Binding InputsShowClutch}" Style="{StaticResource SettingsCheckBox}"/>
                        </StackPanel>

                        <!-- Input Trace Settings -->
                        <StackPanel>
                            <StackPanel.Style>
                                <Style TargetType="StackPanel">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedWidgetId}" Value="input-trace">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </StackPanel.Style>

                            <TextBlock Text="INPUT TRACE SETTINGS" FontSize="11" FontWeight="Bold" Foreground="{StaticResource RO.MutedBrush}" Margin="0,0,0,8"/>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Update Interval (ms)" Style="{StaticResource SettingsLabel}"/>
                                <TextBox Text="{Binding InputTraceUpdateIntervalMs, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource SettingsTextBox}"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="History (seconds)" Style="{StaticResource SettingsLabel}"/>
                                <TextBox Text="{Binding InputTraceHistorySeconds, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource SettingsTextBox}"/>
                            </StackPanel>

                            <TextBlock Text="COLORS" FontSize="11" FontWeight="Bold" Foreground="{StaticResource RO.MutedBrush}" Margin="0,16,0,8"/>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Throttle" Style="{StaticResource SettingsLabel}"/>
                                <TextBox Text="{Binding InputTraceThrottleColor, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource SettingsTextBox}" Width="80"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Brake" Style="{StaticResource SettingsLabel}"/>
                                <TextBox Text="{Binding InputTraceBrakeColor, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource SettingsTextBox}" Width="80"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Position Section (shared) -->
                        <TextBlock Text="POSITION" FontSize="11" FontWeight="Bold" Foreground="{StaticResource RO.MutedBrush}" Margin="0,16,0,8"/>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Overlay Position" Style="{StaticResource SettingsLabel}"/>
                            <TextBlock Text="{Binding OverlayPositionText}" Foreground="{StaticResource RO.ForegroundBrush}" FontSize="12" VerticalAlignment="Center"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Border>

        </DockPanel>
    </Grid>
</Window>
